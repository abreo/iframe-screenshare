<!DOCTYPE html>
<html>
<head>
    <title>Child app</title>
    <script type="text/javascript" src="bower_components/localmedia/localMedia.bundle.js"></script>
</head>
<body>
    <h1> Child app </h1>
    <p> running on https://localhost.mypurecloud.com </p>

    <button id="gobutton">Go</button>
    <script type="text/javascript">
        window.onmessage = function (e) {
            console.log('child got message', e.data);
            source = e.source;

            if (!e.data || !e.data.sourceId) {
                console.log('user cancelled');
                return;
            }

            var constraints = {
                audio: false,
                video: {
                    mandatory: {
                        chromeMediaSource: 'desktop',
                        maxWidth: window.screen.width,
                        maxHeight: window.screen.height,
                        maxFrameRate: 15,
                        chromeMediaSourceId: e.data.sourceId
                    }
                }
            };
            window.navigator.mediaDevices.getUserMedia(constraints).then(function (mediaStream) {
                console.log('got screen in child', mediaStream)
                var v = document.createElement('video');
                document.body.appendChild(v);
                v.srcObject = mediaStream;
                v.autoplay = 'autoplay';
            }).catch(function (err) { console.error(err); });
        }
        function sendMessageToParent() {
            console.log('child sending message');
            window.parent.postMessage({ type: 'getScreen', id: 1, url: 'https://localhost.mypurecloud.com:8446' }, 'https://localhost.quicken.com:8445');
        }
        document.getElementById('gobutton').onclick = sendMessageToParent;
    </script>
</body>
